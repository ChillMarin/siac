let vm=new Vue({vuetify:vuetify,el:"#siac-suite-container",data:{barAlert:!1,barTimeout:1e3,barMessage:"",barType:"",loading:!1,material_loading:!1,dialog:!1,dialogDelete:!1,materialFormDialog:!1,viewDialog:!1,search:"",searched:!1,title:"",material_type:"",editor1Content:"",editor2Content:"",template_selected:[],options:{year:"numeric",month:"long",day:"numeric"},isSelected:!1,patient_id:"",patient_fullname:"",patient_results:[],patients:[],templates:{loading:!1,create_loading:!1,list_loading:!1,create_form_valid:!1,rules:{nameRules:[e=>!!e||"El nombre de la plantilla es requerido"],fileRules:[e=>!!e||"El archivo de la plantilla es requerido"]},search:"",headers:[{text:"Material",align:"start",value:"material_name",width:"auto"},{text:"Acción",align:"center",value:"actions",width:"auto"}],items:[],editedItem:{},editedIndex:-1,defaultItem:{material_id:"",type:"C",material_name:"",source:void 0}},headers:[{text:"Fecha del material enviado",align:"start",value:"registered_at",width:"auto"},{text:"Nombre del material",value:"title",width:"auto"},{text:"Acciones",value:"actions",align:"center",sortable:!1}],patients_material:[],materials_sent:{dialog:!1,loading:!1,headers:[{text:"Fecha",align:"start",value:"registered_at",width:"auto"},{text:"Paciente",value:"full_name",width:"auto"},{text:"Acciones",value:"actions",width:"auto"}],items:[],editedItem:{material_name:""}},editedItem:{title:"",message:"",content:"",material_type:"",file:""},defaulItem:{title:"",message:"<p> </p>",content:"<p> </p>",material_type:"",file:""},patient:{},editedIndex:-1},watch:{isSelected(){this.getPatientMaterial(this.isSelected)}},computed:{searchPatient(){return this.patients_results=this.patients.filter(e=>e.full_name.toLowerCase().includes(this.search.toLowerCase()))}},created(){this.initialize()},mounted(){},methods:{initialize(){var e=api_url+"patients/get",t=this;t.templates.list_loading=!0,t.$http.get(e).then(e=>{if(e.body.length>0){var a=[];e.body.forEach(e=>{var t={};t.patient_id=e.patient_id,t.first_name=e.first_name,t.last_name=e.last_name,t.full_name=e.first_name+" "+e.last_name,t.email=e.email,t.birthdate=e.birthdate,a.push(t)}),t.patients=a}},e=>{}).then(a=>{e=api_url+"material-templates/get",t.$http.get(e).then(e=>{t.templates.list_loading=!1,e.body.length>0&&(t.templates.items=e.body)},e=>{})},e=>{})},getPatientMaterial(e){var t=this;if(e){t.patients_material=[];var a=api_url+"patients-material/get/"+t.patient.patient_id;t.$http.get(a).then(e=>{e.body.length>0&&(t.patients_material=e.body)},e=>{})}},getMaterialsSent(){var e=this;e.materials_sent.loading=!0,e.materials_sent.items=[];var t=api_url+"patients-material/get-sent/"+e.materials_sent.editedItem.material_id;e.$http.get(t).then(t=>{t.body.length>0&&(e.materials_sent.items=t.body),e.materials_sent.loading=!1},t=>{e.materials_sent.loading=!1})},resetSearch(){this.searched=!1,this.isSelected=!1,this.patient_id="",this.patient={}},filterPatient(e){var t=this.patients.find(t=>t.patient_id==e);return null!=t?(this.patient=t,this.materials_sent.dialog=!1,this.isSelected=!0,this.$refs.patient_materials_title.scrollIntoViewIfNeeded({behavior:"smooth"}),this.getPatientMaterial()):activateAlert("No se ha encontrado este paciente, intente de nuevo.","warning"),t},showItem(e){this.editedIndex=this.patients_material.indexOf(e),this.editedItem=Object.assign({},e),this.viewDialog=!0},showMaterialsSent(e){this.materials_sent.editedItem=Object.assign({},e),this.materials_sent.dialog=!0,this.getMaterialsSent()},showCreateMaterialDialog(){this.templates.editedItem=Object.assign({},this.templates.defaulItem),this.templates.create_dialog=!0},deleteItem(e){this.editedIndex=this.patients_material.indexOf(e),this.editedItem=Object.assign({},e),this.dialogDelete=!0},deleteItemConfirm(){var e=this,t=api_url+"patients-material/delete";e.$http.post(t,{patient_material_id:e.editedItem.patient_material_id}).then(t=>{"success"==t.body.status&&e.patients_material.splice(e.editedIndex,1),activateAlert(t.body.message,t.body.status),e.closeDelete()},t=>{e.closeDelete()})},deleteMaterialItem(e){this.templates.editedIndex=this.templates.items.indexOf(e),this.templates.editedItem=Object.assign({},e),this.templates.delete_dialog=!0},deleteMaterialItemConfirm(){var e=this,t=api_url+"material-templates/delete";e.$http.post(t,e.templates.editedItem).then(t=>{"success"==t.body.status&&(e.templates.items.splice(e.templates.editedIndex,1),e.template_selected=[]),activateAlert(t.body.message,t.body.status),e.closeMaterialDelete()},t=>{e.closeMaterialDelete()})},close(){this.dialog=!1,this.materialFormDialog=!1,this.$nextTick(()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1})},closeViewDialog(){this.dialog=!1,this.viewDialog=!1,this.$nextTick(()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1})},closeCreateMaterialDialog(){this.templates.create_dialog=!1,this.$nextTick(()=>{this.templates.editedItem=Object.assign({},this.templates.defaultItem)})},closeDelete(){this.dialogDelete=!1,this.$nextTick(()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1})},closeMaterialDelete(){this.templates.delete_dialog=!1,this.$nextTick(()=>{this.templates.editedItem=Object.assign({},this.templates.defaultItem),this.templates.editedIndex=-1})},save(){var e=this;e.material_loading=!0;e.editedIndex;var t=new FormData;t.append("patient_id",e.patient.patient_id),t.append("email",e.patient.email),t.append("first_name",e.patient.first_name),t.append("last_name",e.patient.last_name),t.append("full_name",e.patient.full_name),t.append("file",e.editedItem.file),t.append("title",e.editedItem.title),t.append("material",e.editedItem.material_type),t.append("content",e.editedItem.content),t.append("message",e.editedItem.message),"template"==e.editedItem.material_type&&t.append("templates",JSON.stringify(e.template_selected));var a=api_url+"patients-material/create";e.$http.post(a,t).then(t=>{e.material_loading=!1,"success"==t.body.status&&(e.editedItem.registered_at=moment().format("YYYY-MM-DD")),e.editedItem.patient_material_id=t.body.data.patient_material_id,e.editedItem.file=t.body.data.file,e.editedItem.files=t.body.data.files,e.patients_material.push(e.editedItem),e.close(),activateAlert(t.body.message,t.body.status)},t=>{activateAlert("Ocurrió un error inesperado, intente de nuevo.","error"),e.material_loading=!1})},saveMaterialTemplate(){var e=this,t=e.templates.editedItem;if(e.$refs.material_template_form.validate()){e.templates.create_loading=!0;var a=new FormData;a.append("material_name",t.material_name),a.append("source",t.source);var i=api_url+"material-templates/create";e.$http.post(i,a).then(a=>{e.templates.create_loading=!1,"success"==a.body.status&&(e.templates.create_dialog=!1,t.material_id=a.body.data.material_id,t.source=a.body.data.source,t.type="C",e.templates.items.push(t)),activateAlert(a.body.message,a.body.status)},t=>{activateAlert("Ocurrió un error inesperado, intente de nuevo.","error"),e.templates.create_loading=!1})}},downloadMaterialExample(e){var t=this,a=api_url+"patients-material/get-standard-example";t.$http.post(a,e).then(a=>{if("success"==a.body.status){t.pdf_loading=!1;var i=a.body,s=document.createElement("a");s.href=i.content,document.body.append(s),s.download=e.material_name+".pdf",s.click(),s.remove()}},e=>{})}}});