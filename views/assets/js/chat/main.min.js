let vm=new Vue({vuetify:vuetify,el:"#siac-suite-container",data:{uid:uid,search_member:"",search_external_member:"",group_dialog:!1,private_chat:!1,external_upcm_dialog:!1,loading:!1,group_loading:!1,upload_file:!1,tab:null,message:"",file_media:null,upcm_chats:[],upcm_members:[],group_chats:[],external_chats:[],external_members:[],group_form:{group_name:"",members:[],external_members:[]},opened_chat:{user_id:"",first_name:"",last_name:"",email:"",rol:"",messages:[]},files:[],chat:[]},computed:{},created:function(){this.initialize()},mounted:function(){},methods:{initialize:function(){this.getUPCMChats(),this.getExternalChats(),this.getGroupChats()},getUPCMChats:function(){var a=this,e=api_url+"chat/get-upcm-chats";a.$http.get(e).then(e=>{var t;0<e.body.length&&(a.upcm_chats=e.body,t=[],e.body.forEach(e=>{e.user_id!=uid&&(e={full_name:e.first_name+" "+e.last_name,user_id:e.user_id},t.push(e))}),a.upcm_members=t,a.upcm_members_list=t)},e=>{})},getExternalChats:function(){var t=this,e=api_url+"chat/get-external-upcm-chats";t.$http.get(e).then(e=>{0<e.body.length&&(t.external_chats=e.body)},e=>{})},getGroupChats:function(){var t=this,e=api_url+"group-chat/get";t.$http.get(e).then(e=>{0<e.body.length&&(t.group_chats=e.body)},e=>{})},getMessages:function(){var t=this,e=api_url+"chat/get-messages";data={sender:t.opened_chat.user_id,receiver:uid},t.chat=[],t.$http.post(e,data).then(e=>{0<e.body.length&&(t.chat=e.body)},e=>{})},getGroupMessages:function(){var t=this,e=api_url+"group-chat/get-messages";data={group_id:t.opened_chat.group_id},t.chat=[],t.$http.post(e,data).then(e=>{0<e.body.length&&(t.chat=e.body)},e=>{})},saveGroup:function(){var t=this,e=api_url+"group-chat/create-group";if(""==t.group_form.group_name||0==t.group_form.members.length)return!1;t.group_loading=!0,t.$http.post(e,t.group_form).then(e=>{t.group_loading=!1,"success"==e.body.status&&(t.group_chats.push(t.group_form),t.group_dialog=!1)},e=>{t.group_loading=!1})},sendMessage:function(){var t=this,e=[],a=moment().format("YYYY-MM-DD hh:mm:ss");if(""==t.message&&!upload_file)return!1;var s={receiver:t.opened_chat.user_id,sender:uid,message:t.message,message_time:a,file:null},e=new FormData;t.loading=!0,e.append("receiver",t.opened_chat.user_id),e.append("message",t.message),e.append("file",t.file_media);a=api_url+"chat/send-message";t.$http.post(a,e).then(e=>{"success"==e.body.status&&(s.file=e.body.data,t.file_media=null,t.loading=!1,t.upload_file=!1,t.chat.push(s),t.message="")},e=>{t.loading=!1})},sendGroupMessage:function(){var t=this,e=[],a=moment().format("YYYY-MM-DD hh:mm:ss");if(""==t.message&&!upload_file)return!1;var s={group_id:t.opened_chat.group_id,sender:uid,message:t.message,message_time:a,file:null},e=new FormData;t.loading=!0,e.append("group_id",t.opened_chat.group_id),e.append("message",t.message),e.append("file",t.file_media);a=api_url+"group-chat/send-message";t.$http.post(a,e).then(e=>{"success"==e.body.status&&(s.file=e.body.data,t.file_media=null,t.loading=!1,t.upload_file=!1,t.chat.push(s),t.message="")},e=>{t.loading=!1})},getTimeHour:function(e){return moment(e).format("h:mm")},openChat:function(e){var t=this;t.opened_chat=Object.assign({},e),t.private_chat=!0,t.getMessages()},openGroupChat:function(e){var t=this;t.private_chat=!1,t.opened_chat=Object.assign({},e),t.getGroupMessages()},scrollChat:function(){document.getElementById("chat_container").scroll(0,4*window.innerHeight)},getExt:function(e){return e.split(".")[1]},getExtIcon:function(e){var t="";switch(e.split(".")[1]){case"pdf":t="pdf";break;case"docx":case"doc":t="word";break;case"ppt":case"pptx":case"ppt":t="powerpoint";break;case"xls":t="excel";break;default:t="document"}return t},prevImage:function(e,a){if(!e)return!1;var t=new Image,s=window.location.protocol+"//"+window.location.hostname;"localhost"==window.location.hostname&&(s+=":"+window.location.port),t.src=s+"/public/media/chat/"+e,this.private_chat||(t.src=s+"/public/media/group_chat/"+e);var o=new Viewer(t,{hidden:function(){o.destroy()},title:[1,(e,t)=>a]});o.show()},searchMembers:function(e){var t=this;t.search_member||(t.upcm_members=t.upcm_members_list),t.upcm_members=t.upcm_members_list.filter(e=>-1<e.full_name.toLowerCase().indexOf(t.search_member.toLowerCase()))}}});