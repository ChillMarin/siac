moment.locale("es");let vm=new Vue({vuetify:vuetify,el:"#siac-suite-container",data:{barAlert:!1,barTimeout:1e3,barMessage:"",barType:"",loading:!1,join_loading:!1,dialog:!1,dialogDelete:!1,viewDialog:!1,all_announcements:!0,user_id:-1,uid:uid,editedIndex:-1,send_to_options:[{text:"Todas las unidades",value:"0"},{text:"A todos los integrantes de mi unidad",value:"1"},{text:"Integrantes específicos de mi unidad",value:"2"},{text:"Unidades específicas",value:"3"},{text:"Miembros específicos de otra unidad",value:"4"}],announcements:[],my_upcm_members:{loading:!1,items:[]},upcms:{loading:!1,items:[],filtered_items:[],search:""},external_upcm_members:{loading:!1,items:[]},author:{},editedItem:{},defaultItem:{title:"",content:"",send_to:0,upcm_id:"",upcms:[],members:[],published_at:moment().format("YYYY-MM-DD hh:mm:ss")}},computed:{formTitle(){return-1===this.editedIndex?"Crear anuncio":"Editar anuncio"},filterByDate(){if(!this.all_announcements){var e=this.user_id,t=this.announcements.filter(t=>t.user_id==e);t=t.sort((e,t)=>e.published_at<t.published_at?1:-1);return t}return this.announcements.sort((e,t)=>e.published_at<t.published_at?1:-1)},announcementBtnTitle(){return this.all_announcements?"Mis anuncios":"Todos los anuncios"}},created(){this.initializeMyMembers(),this.initializeUPCMS(),this.initialize()},mounted(){},methods:{initialize(){var e=api_url+"announcements/get";this.$http.get(e).then(e=>{e.body.forEach(e=>{e.members.length>0&&e.members.forEach(e=>{e.text=`${e.first_name} ${e.last_name}`,e.value=e.user_id}),e.upcms.length>0&&e.upcms.forEach(e=>{e.text=e.upcm_name,e.value=e.upcm_id})}),this.announcements=e.body},e=>{})},initializeUPCMS(){var e=api_url+"upcms/upcm-list";this.$http.get(e).then(e=>{e.body.length>0&&(e.body.forEach(e=>{e.text=e.upcm_name,e.value=e.upcm_id}),e.body),this.upcms.filtered_items=e.body,this.upcms.items=e.body},e=>{})},initializeMyMembers(){var e=api_url+"members/upcm-members";this.$http.get(e).then(e=>{var t=[];e.body.length>0&&e.body.forEach(e=>{e.user_id!=uid&&(e.text=`${e.first_name} ${e.last_name}`,e.value=e.user_id,t.push(e))}),this.my_upcm_members.items=t},e=>{})},getExternalUPCMMembers(){var e=api_url+"members/upcm-members/"+this.editedItem.upcm_id;this.$http.get(e).then(e=>{var t=[];e.body.length>0&&e.body.forEach(e=>{e.text=`${e.first_name} ${e.last_name}`,e.value=e.user_id,t.push(e)}),this.external_upcm_members.items=t},e=>{})},joinChat(e){var t=this;t.join_loading=!0;var s=api_url+"group-chat/join-group",i={group_id:t.author.group_chat,user_id:uid};t.$http.post(s,i).then(e=>{t.join_loading=!1,"success"==e.body.status&&(t.author.user_member=uid,window.open(window.location.origin+"/suite/chat/","_blank"))},e=>{})},editItem(e){this.editedIndex=this.announcements.indexOf(e),this.editedItem=Object.assign({},e),this.dialog=!0},deleteItem(e){this.editedIndex=this.announcements.indexOf(e),this.editedItem=Object.assign({},e),this.dialogDelete=!0},deleteItemConfirm(){var e=this.editedItem.announcement_id,t=api_url+"announcements/delete";this.$http.post(t,{announcement_id:e}).then(e=>{"success"==e.body.status&&this.announcements.splice(this.editedIndex,1),this.closeDelete(),activateAlert(e.body.message,e.body.status)},e=>{this.closeDelete()})},closeDelete(){this.dialogDelete=!1,this.$nextTick(()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1})},close(){this.dialog=!1,this.$nextTick(()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1})},save(){var e=this,t=e.editedIndex;if(e.editedIndex>-1){var s=api_url+"announcements/update";e.$http.post(s,e.editedItem).then(s=>{"success"==s.body.status&&Object.assign(e.announcements[t],e.editedItem),e.close(),activateAlert(s.body.message,s.body.status)},t=>{e.close()})}else{s=api_url+"group-chat/create-group";e.$http.post(s,{group_name:e.editedItem.title}).then(t=>{if("success"==t.body.status){var s=t.body.data,i=api_url+"announcements/create";e.editedItem.group_chat=s,e.$http.post(i,e.editedItem).then(t=>{"success"==t.body.status&&(e.editedItem.published_at=moment().format("YYYY-MM-DD hh:mm:ss"),e.editedItem.user_id=t.body.data.user_id,e.editedItem.announcement_id=t.body.data.announcement_id,e.announcements.push(e.editedItem)),activateAlert(t.body.message,t.body.status),e.close()},t=>{e.close()})}})}},switchAnnouncenments(e){this.all_announcements?this.all_announcements=!1:this.all_announcements=!0,this.user_id=e},get_announcement(e){var t=this;t.author={};var s=api_url+"announcements/get-author";t.viewDialog=!0,t.editedItem=Object.assign({},e);var i={announcement_id:e.announcement_id,group_id:e.group_chat};t.$http.post(s,i).then(e=>{t.author=e.body},e=>{})},searchUPCMS(){var e=this;""==e.upcms.search&&(e.upcms.filtered_items=e.upcms.items),e.upcms.filtered_items=e.upcms.items.filter(t=>t.text.toLowerCase().indexOf(e.upcms.search.toLowerCase())>-1)},clearSendToInputs(){var e=this.editedItem;e.upcms=[],e.members=[],e.upcm_id=""},fromNow:e=>moment(e).fromNow()}});