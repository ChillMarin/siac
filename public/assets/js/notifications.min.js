moment.locale("es");let vm=new Vue({vuetify:vuetify,el:"#siac-suite-container",data:{barAlert:!1,barTimeout:1e3,barMessage:"",barType:"",loading:!1,join_loading:!1,dialog:!1,dialogDelete:!1,viewDialog:!1,all_announcements:!0,user_id:-1,uid:uid,editedIndex:-1,send_to_options:[{text:"Todas las unidades",value:"0"},{text:"A todos los integrantes de mi unidad",value:"1"},{text:"Integrantes específicos de mi unidad",value:"2"},{text:"Unidades específicas",value:"3"},{text:"Miembros específicos de otra unidad",value:"4"}],announcements:[],my_upcm_members:{loading:!1,items:[]},upcms:{loading:!1,items:[],filtered_items:[],search:""},external_upcm_members:{loading:!1,items:[]},author:{},editedItem:{},defaultItem:{title:"",content:"",send_to:0,upcm_id:"",upcms:[],members:[],published_at:moment().format("YYYY-MM-DD hh:mm:ss")}},computed:{formTitle(){return-1===this.editedIndex?"Crear anuncio":"Editar anuncio"},filterByDate(){if(!this.all_announcements){var user_id=this.user_id,my_announcements,my_announcements;return my_announcements=(my_announcements=this.announcements.filter(announcement=>announcement.user_id==user_id)).sort((a,b)=>a.published_at<b.published_at?1:-1)}return this.announcements.sort((a,b)=>a.published_at<b.published_at?1:-1)},announcementBtnTitle(){return this.all_announcements?"Mis anuncios":"Todos los anuncios"}},created(){this.initializeMyMembers(),this.initializeUPCMS(),this.initialize()},mounted(){},methods:{initialize(){var url=api_url+"announcements/get";this.$http.get(url).then(res=>{res.body.forEach(e=>{e.members.length>0&&e.members.forEach(m=>{m.text=`${m.first_name} ${m.last_name}`,m.value=m.user_id}),e.upcms.length>0&&e.upcms.forEach(u=>{u.text=u.upcm_name,u.value=u.upcm_id})}),this.announcements=res.body},err=>{})},initializeUPCMS(){var url=api_url+"upcms/upcm-list";this.$http.get(url).then(res=>{var items=[];res.body.length>0&&(res.body.forEach(e=>{e.text=e.upcm_name,e.value=e.upcm_id}),items=res.body),this.upcms.filtered_items=res.body,this.upcms.items=res.body},err=>{})},initializeMyMembers(){var url=api_url+"members/upcm-members";this.$http.get(url).then(res=>{var items=[];res.body.length>0&&res.body.forEach(e=>{e.user_id!=uid&&(e.text=`${e.first_name} ${e.last_name}`,e.value=e.user_id,items.push(e))}),this.my_upcm_members.items=items},err=>{})},getExternalUPCMMembers(){var url=api_url+"members/upcm-members/"+this.editedItem.upcm_id;this.$http.get(url).then(res=>{var items=[];res.body.length>0&&res.body.forEach(e=>{e.text=`${e.first_name} ${e.last_name}`,e.value=e.user_id,items.push(e)}),this.external_upcm_members.items=items},err=>{})},joinChat(item){var app=this;app.join_loading=!0;var url=api_url+"group-chat/join-group",data={group_id:app.author.group_chat,user_id:uid};app.$http.post(url,data).then(res=>{app.join_loading=!1,"success"==res.body.status&&(app.author.user_member=uid,window.open(window.location.origin+"/suite/chat?group="+res.body.data,"_blank"))},err=>{})},editItem(item){this.editedIndex=this.announcements.indexOf(item),this.editedItem=Object.assign({},item),this.dialog=!0},deleteItem(item){this.editedIndex=this.announcements.indexOf(item),this.editedItem=Object.assign({},item),this.dialogDelete=!0},deleteItemConfirm(){var id=this.editedItem.announcement_id,url=api_url+"announcements/delete";this.$http.post(url,{announcement_id:id}).then(res=>{"success"==res.body.status&&this.announcements.splice(this.editedIndex,1),this.closeDelete(),activateAlert(res.body.message,res.body.status)},err=>{this.closeDelete()})},closeDelete(){this.dialogDelete=!1,this.$nextTick(()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1})},close(){this.dialog=!1,this.$nextTick(()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1})},save(){var app=this,editedIndex=app.editedIndex;if(app.editedIndex>-1){var url=api_url+"announcements/update";app.$http.post(url,app.editedItem).then(res=>{"success"==res.body.status&&Object.assign(app.announcements[editedIndex],app.editedItem),app.close(),activateAlert(res.body.message,res.body.status)},err=>{app.close()})}else{var url=api_url+"group-chat/create-group";app.$http.post(url,{group_name:app.editedItem.title}).then(res=>{if("success"==res.body.status){var group_id=res.body.data,url=api_url+"announcements/create";app.editedItem.group_chat=group_id,app.$http.post(url,app.editedItem).then(res=>{"success"==res.body.status&&(app.editedItem.published_at=moment().format("YYYY-MM-DD hh:mm:ss"),app.editedItem.user_id=res.body.data.user_id,app.editedItem.announcement_id=res.body.data.announcement_id,app.announcements.push(app.editedItem)),activateAlert(res.body.message,res.body.status),app.close()},err=>{app.close()})}})}},switchAnnouncenments(user){this.all_announcements?this.all_announcements=!1:this.all_announcements=!0,this.user_id=user},get_announcement(item){var app=this;app.author={};var url=api_url+"announcements/get-author";app.viewDialog=!0,app.editedItem=Object.assign({},item);var data={announcement_id:item.announcement_id,group_id:item.group_chat};app.$http.post(url,data).then(res=>{app.author=res.body},err=>{})},searchUPCMS(){var app=this;""==app.upcms.search&&(app.upcms.filtered_items=app.upcms.items),app.upcms.filtered_items=app.upcms.items.filter(upcm=>upcm.text.toLowerCase().indexOf(app.upcms.search.toLowerCase())>-1)},clearSendToInputs(){var item=this.editedItem;item.upcms=[],item.members=[],item.upcm_id=""},fromNow:date=>moment(date).fromNow()}});