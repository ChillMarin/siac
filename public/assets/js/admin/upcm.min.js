let vm=new Vue({vuetify:vuetify,el:"#siac-suite-container",data:{barAlert:!1,barTimeout:1e3,barMessage:"",barType:"",loading:!1,save_loading:!1,dialog:!1,dialogDelete:!1,upcmInvitationsDialog:!1,viewDialog:!1,upcm_image:null,preview_image:null,headers:[{text:"Nombre",align:"start",value:"upcm_name"},{text:"Provincia / País",value:"location"},{text:"Clave de certificación",value:"upcm_key"},{text:"Fecha de registro",value:"upcm_registered"},{text:"Acciones",value:"actions",align:"center",sortable:!1}],upcms:[],upcm_invitations:{dialog:!1,loading:!1,create_loading:!1,items:[],headers:[{text:"Nombre completo",align:"start",value:"full_name"},{text:"Correo electrónico",value:"user_email"},{text:"Rol",value:"rol"},{text:"Tipo",value:"user_type"},{text:"Acciones",value:"actions",align:"center",sortable:!1}],editedItem:{first_name:"",last_name:"",user_email:"",user_type:"miembro",rol:"Cardiólogo",created_at:"",already_used:0,access:{patient_management_access:{access:1,sections:[{name:"Pacientes",page:"patients",permissions:{create:1,read:1,update:1,delete:1}},{name:"Citas",page:"appointments",permissions:{create:1,read:1,update:1,delete:1}}]},calculations_and_algorithms_access:{access:1},patient_material_access:{access:1,sections:[{name:"Materiales para pacientes",page:"patients",permissions:{create:1,read:1,delete:1}},{name:"Plantillas",page:"templates",permissions:{create:1,read:1,delete:1}}]},notifications_access:{access:1,publish:1}}},defaultItem:{first_name:"",last_name:"",user_email:"",user_type:"miembro",rol:"Cardiólogo",created_at:"",already_used:0,access:{patient_management_access:{access:1,sections:[{name:"Pacientes",page:"patients",permissions:{create:1,read:1,update:1,delete:1}},{name:"Citas",page:"appointments",permissions:{create:1,read:1,update:1,delete:1}}]},calculations_and_algorithms_access:{access:1},patient_material_access:{access:1,sections:[{name:"Materiales para pacientes",page:"patients",permissions:{create:1,read:1,delete:1}},{name:"Plantillas",page:"templates",permissions:{create:1,read:1,delete:1}}]},notifications_access:{access:1,publish:1}}}},countries:[],states:[],country_states:[],rols:["Cardiólogo","Enfermera","Enfermero","Secretaria"],editedIndex:-1,editedItem:{upcm_logo:"",upcm_name:"",upcm_email:"",upcm_address:"",upcm_country:"",upcm_state:"",meta:{instagram:"",twitter:"",facebook:""},upcm_registered:current_date},defaultItem:{upcm_logo:"",upcm_name:"",upcm_email:"",upcm_address:"",upcm_country:"",upcm_state:"",meta:{instagram:"",twitter:"",facebook:""},upcm_registered:current_date}},computed:{formTitle(){return-1===this.editedIndex?"Registrar UPCM":"Editar UPCM"}},watch:{dialog(e){e||this.close()},dialogDelete(e){e||this.closeDelete()},upcmInvitationsDialog(e){e||this.closeInvitation()}},created(){this.initialize()},mounted(){this.loadCountries()},methods:{initialize(){var e=api_url+"upcms/get";this.$http.get(e).then(e=>{this.upcms=e.body},e=>{})},loadInvitations(){var e=api_url+"upcm-invitations/get/"+this.editedItem.upcm_id;this.$http.get(e).then(e=>{e.body.forEach(e=>{Array.isArray(e.access)&&(e.access={})}),this.upcm_invitations.items=e.body},e=>{})},editItem(e){this.editedIndex=this.upcms.indexOf(e),this.editedItem=Object.assign({},e),this.dialog=!0},viewItem(e){this.editedIndex=this.upcms.indexOf(e),this.editedItem=Object.assign({},e),this.viewDialog=!0},editInvitationItem(){this.upcm_invitations.editedItem=Object.assign({},this.upcm_invitations.defaultItem),this.upcmInvitationsDialog=!0},deleteItem(e){this.editedIndex=this.upcms.indexOf(e),this.editedItem=Object.assign({},e),this.dialogDelete=!0},deleteItemConfirm(){var e=this.editedItem.upcm_id,t=api_url+"upcms/delete";this.$http.post(t,{upcm_id:e}).then(e=>{"success"==e.body.status&&this.upcms.splice(this.editedIndex,1),this.closeDelete(),activateAlert(e.body.message,e.body.status)},e=>{this.closeDelete()})},closeDelete(){this.dialogDelete=!1,this.$nextTick(()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1})},close(){this.dialog=!1,this.$nextTick(()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1})},closeInvitation(){this.upcmInvitationsDialog=!1,this.$nextTick(()=>{this.upcm_invitations.editedItem=Object.assign({},this.upcm_invitations.defaultItem),this.upcm_invitations.editedIndex=-1})},save(){var e=this,t=e.editedIndex,i=e.editedItem,a=new FormData;if(a.append("upcm_name",i.upcm_name),a.append("upcm_logo",i.upcm_logo),a.append("upcm_image",e.upcm_image),a.append("upcm_email",i.upcm_email),a.append("upcm_key",i.upcm_key),a.append("upcm_address",i.upcm_address),a.append("upcm_country",i.upcm_country),a.append("upcm_state",i.upcm_state),a.append("meta",JSON.stringify(i.meta)),e.save_loading=!0,e.editedIndex>-1){var s=api_url+"upcms/update";a.append("upcm_id",i.upcm_id),e.$http.post(s,a).then(a=>{"success"==a.body.status&&(i.upcm_logo=a.body.data.upcm_logo,Object.assign(e.upcms[t],i)),e.save_loading=!1,activateAlert(a.body.message,a.body.status),e.close()},t=>{e.close()})}else{s=api_url+"upcms/create";e.$http.post(s,a).then(t=>{"success"==t.body.status&&(i.upcm_logo=t.body.data.upcm_logo,i.upcm_registered=current_date,i.upcm_id=t.body.data.upcm_id,e.upcms.push(i)),e.save_loading=!1,activateAlert(t.body.message,t.body.status),e.close()},t=>{e.save_loading=!1,e.close()})}},saveInvitation(){var e=this,t=e.upcm_invitations.editedItem;t.upcm_id=e.editedItem.upcm_id,t.upcm_name=e.editedItem.upcm_name,e.upcm_invitations.create_loading=!0;var i=api_url+"upcm-invitations/create";e.$http.post(i,t).then(i=>{"success"==i.body.status&&(t.created_at=current_date,t.upcm_invitation_id=i.body.data.upcm_invitation_id,t.invitation_code=i.body.data.invitation_code,e.upcm_invitations.items.push(t)),e.upcm_invitations.create_loading=!1,activateAlert(i.body.message,i.body.status),e.closeInvitation()},t=>{e.upcm_invitations.create_loading=!1,e.closeInvitation()})},deleteInvitation(e){var t=this,i=t.upcm_invitations.items.indexOf(e),a=api_url+"upcm-invitations/delete/"+e.upcm_invitation_id;t.$http.get(a).then(e=>{"success"==e.body.status&&t.upcm_invitations.items.splice(i,1)},e=>{})},formatDate(e){var t=new Date(e);return t.toLocaleString("es-ES",date_options)},loadCountries(){this.$http.get("/public/js/countries.min.json").then(e=>{this.countries=e.body.countries},e=>{}),this.$http.get("/public/js/states.min.json").then(e=>{this.states=e.body.states},e=>{})},filterStates(){var e=this.states,t=this.editedItem.country_selected,i=e.filter(e=>e.id_country==t);return this.country_states=i},getCountryName(){var e=this,t=e.countries,i=e.editedItem.country_selected,a=t.filter(e=>e.id==i);return e.editedItem.upcm_country=a[0].name},getStateName(){var e=this,t=e.states,i=e.editedItem.state_selected,a=t.filter(e=>e.id==i);return e.editedItem.upcm_state=a[0].name},prevImage(e){const t=e.target.files[0],i=new FileReader;i.readAsDataURL(t),i.onload=(e=>{this.upcm_image=t,this.preview_image=e.target.result,this.undone_button=!0})},getLocation(){this.getCountryName(),this.getStateName()},copyToClipboard(e){navigator.clipboard.writeText(e)},filterAccessByRol(){var e=this;if("miembro"==e.upcm_invitations.editedItem.user_type){var t=[{rol_obj:"cardiologist",rol:"Cardiólogo"},{rol_obj:"nurse",rol:"Enfermera"},{rol_obj:"nurse",rol:"Enfermero"},{rol_obj:"secretary",rol:"Secretaria"}],i=t.find(t=>t.rol==e.upcm_invitations.editedItem.rol);i.hasOwnProperty("rol_obj")&&(e.upcm_invitations.editedItem.access=Object.assign({},user_roles[i.rol_obj]))}}}});